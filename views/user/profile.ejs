<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Profile</title>

    <!--===============================================================================================-->	
	<link rel="icon" type="image/png" href="images/icons/favicon.png"/>
    <!--===============================================================================================-->
        <link rel="stylesheet" type="text/css" href="/vendor/bootstrap/css/bootstrap.min.css">
    <!--===============================================================================================-->
        <link rel="stylesheet" type="text/css" href="/fonts/font-awesome-4.7.0/css/font-awesome.min.css">
    <!--===============================================================================================-->
        <link rel="stylesheet" type="text/css" href="/fonts/iconic/css/material-design-iconic-font.min.css">
    <!--===============================================================================================-->
        <link rel="stylesheet" type="text/css" href="/fonts/linearicons-v1.0.0/icon-font.min.css">
    <!--===============================================================================================-->
        <link rel="stylesheet" type="text/css" href="/vendor/animate/animate.css">
    <!--===============================================================================================-->	
        <link rel="stylesheet" type="text/css" href="/vendor/css-hamburgers/hamburgers.min.css">
    <!--===============================================================================================-->
        <link rel="stylesheet" type="text/css" href="/vendor/animsition/css/animsition.min.css">
    <!--===============================================================================================-->
        <link rel="stylesheet" type="text/css" href="/vendor/select2/select2.min.css">
    <!--===============================================================================================-->	
        <link rel="stylesheet" type="text/css" href="/vendor/daterangepicker/daterangepicker.css">
    <!--===============================================================================================-->
        <link rel="stylesheet" type="text/css" href="/vendor/slick/slick.css">
    <!--===============================================================================================-->
        <link rel="stylesheet" type="text/css" href="/vendor/MagnificPopup/magnific-popup.css">
    <!--===============================================================================================-->
        <link rel="stylesheet" type="text/css" href="/vendor/perfect-scrollbar/perfect-scrollbar.css">
    <!--===============================================================================================-->
        <link rel="stylesheet" type="text/css" href="/css/util.css">
        <link rel="stylesheet" type="text/css" href="/css/main.css">



    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="/css/profile.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
    <!-- Include SweetAlert2 CSS and JS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.all.min.js"></script>

<style>


</style>
    

</head>
<body>


    
    	<!--Header-->
	
	<%- include('partials/_header')%>

    <div class="container-fluid mt-5 ">
        <div class="row ">
            <div class="col-md-3 sidebar_profile">
                <div class="text-center mb-4">
                    <img src="<%= user.profilePicture || '/images/userP.jpg' %>" alt="Profile Image" class="profile-image">
                    <h4><%= user.username %></h4>
                </div>
                <div class="list_profile d-flex align-items-center justify-content-center">
                    <div class="list-group">
                        <a class="list-group-item list-group-item-action section-toggle" href="#" data-target="#details">
                            <i class="fas fa-user"></i> My Details
                        </a>
                        <a class="list-group-item list-group-item-action section-toggle" href="#" data-target="#addresses">
                            <i class="fas fa-map-marker-alt"></i> Addresses
                        </a>
                        <a class="list-group-item list-group-item-action section-toggle" href="#" data-target="#orders">
                            <i class="fas fa-box"></i> Orders
                        </a>
                        <a class="list-group-item list-group-item-action section-toggle" href="#" data-target="#wallet">
                            <i class="fas fa-wallet"></i> Wallet
                        </a>
                    </div>
            </div>
            </div>


            <div class="col-md-9 content">
                <div id="details" class="section hidden" style="position: relative;">
                    <h2>My Details</h2>
                
                    <!-- Share Icon in the top-right corner -->
                    <button id="shareBtn" class="btn btn-link" style="position: absolute; top: 10px; right: 10px;">
                        <i class="fas fa-share-alt"></i>
                    </button>
                
                    <form id="profileForm">
                        <div class="form-group">
                            <label for="username">Username</label>
                            <input type="text" class="form-control" id="username" value="<%= user.username %>" required>
                        </div>
                        <div class="form-group">
                            <label for="email">Email</label>
                            <input type="email" class="form-control" id="email" value="<%= user.email %>" readonly>
                        </div>
                        <button type="submit" class="btn btn-primary">Update Profile</button>
                        <button type="button" class="btn btn-secondary" id="resetPasswordBtn">Change Password</button>
                    </form>
                </div>
                
                                
                
                <!-- Reset Password Modal -->
                <div class="modal" id="resetPasswordModal" tabindex="-1" role="dialog">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Change Password</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                <form id="resetPasswordForm">
                                    <div class="form-group">
                                        <label for="currentEmail">Current Email</label>
                                        <input type="email" class="form-control" id="currentEmail" value="<%= user.email %>" readonly>
                                    </div>
                                    <div class="form-group">
                                        <label for="currentPassword">Current Password</label>
                                        <div class="input-group">
                                            <input type="password" class="form-control" id="currentPassword">
                                            <button type="button" class="btn btn-outline-secondary" id="toggleCurrentPassword">
                                                <i class="bi bi-eye-slash" id="currentPasswordIcon"></i>
                                            </button>
                                        </div>
                                    </div>

                                    <% if (user && user.googleId) { %>
                                        <div class="form-group" id="currentPasswordNote">
                                            <small class="form-text text-muted">Your current password is : 12345678</small>
                                        </div>
                                    <% } %>
                                    
                                    <div class="form-group">
                                        <label for="newPassword">New Password</label>
                                        <div class="input-group">
                                            <input type="password" class="form-control" id="newPassword" required>
                                            <button type="button" class="btn btn-outline-secondary" id="toggleNewPassword">
                                                <i class="bi bi-eye-slash" id="newPasswordIcon"></i>
                                            </button>
                                        </div>
                                    </div>
                                
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                <button type="button" class="btn btn-primary" id="submitResetPassword">Submit</button>
                            </div>
                        </div>
                    </div>
                </div>
                

                


                
                

                <div id="addresses" class="section hidden">
                    <h2>Addresses</h2>
                    <ul class="list-group" id="addressList">
                        <% if (addresses.length > 0) { %>
                            <% addresses.forEach(address => { %>
                                <li class="list-group-item address-item">
                                    <div class="address-info">
                                        <strong><%= address.fullName %></strong><br>
                                        <%= address.address %>, <%= address.city %>, <%= address.pincode %><br>
                                    </div>
                                    <div class="address-actions">
                                        <button id="editAddressModal" class="btn btn-warning btn-sm editAddress" data-id="<%= address._id %>" data-fullname="<%= address.fullName %>" data-phone="<%= address.phone %>" data-address="<%= address.address %>" data-district="<%= address.district %>" data-city="<%= address.city %>" data-state="<%= address.state %>" data-pincode="<%= address.pincode %>" data-country="<%= address.country %>" data-type="<%= address.type %>">Edit</button>
                                        <button class="btn btn-danger btn-sm deleteAddress" data-id="<%= address._id %>">Delete</button>
                                    </div>
                                </li>
                            <% }) %>
                        <% } else { %>
                            <li class="list-group-item">No addresses found.</li>
                        <% } %>
                    </ul>
                
                    <br>
                    <!-- Button to Open Modal for Adding Address -->
                    <button type="button" id="openAddressModal" class="btn btn-primary" data-toggle="modal" data-target="#addressModal">
                        Add Address
                    </button>
                    
                    <!-- Modal for Adding/Editing Address -->
                    <div class="modal fade" id="addressModal" tabindex="-1" role="dialog" aria-labelledby="addressModalLabel" aria-hidden="true">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="addressModalLabel">Add New Address</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <form id="addressForm">
                                        <input type="hidden" id="addressId">    
                                        <div class="form-row">
                                            <div class="form-group col-md-6">
                                                <label for="fullName">Full Name</label>
                                                <input type="text" class="form-control" id="fullName" required>
                                                <span class="text-danger" id="fullNameError"></span>
                                            </div>
                                            <div class="form-group col-md-6">
                                                <label for="phone">Phone</label>
                                                <input type="tel" class="form-control" id="phone" required pattern="[0-9]{10}">
                                                <span class="text-danger" id="phoneError"></span>
                                            </div>
                                        </div>
                                        <div class="form-row">
                                            <div class="form-group col-md-6">
                                                <label for="address">Address</label>
                                                <input type="text" class="form-control" id="address" required>
                                                <span class="text-danger" id="addressError"></span>
                                            </div>
                                            <div class="form-group col-md-6">
                                                <label for="district">District</label>
                                                <input type="text" class="form-control" id="district" required>
                                                <span class="text-danger" id="districtError"></span>
                                            </div>
                                        </div>
                                        <div class="form-row">
                                            <div class="form-group col-md-6">
                                                <label for="city">City</label>
                                                <input type="text" class="form-control" id="city" required>
                                                <span class="text-danger" id="cityError"></span>
                                            </div>
                                            <div class="form-group col-md-6">
                                                <label for="state">State</label>
                                                <input type="text" class="form-control" id="state" required>
                                                <span class="text-danger" id="stateError"></span>
                                            </div>
                                        </div>
                                        <div class="form-row">
                                            <div class="form-group col-md-6">
                                                <label for="pincode">Pincode</label>
                                                <input type="text" class="form-control" id="pincode" required pattern="[0-9]{6}">
                                                <span class="text-danger" id="pincodeError"></span>
                                            </div>
                                            <div class="form-group col-md-6">
                                                <label for="country">Country</label>
                                                <input type="text" class="form-control" id="country" required>
                                                <span class="text-danger" id="countryError"></span>
                                            </div>
                                        </div>
                                        <div class="form-row">
                                            <div class="form-group col-md-6">
                                                <label for="addressType">Address Type</label>
                                                <select class="form-control" id="addressType" required>
                                                    <option value="" disabled selected>Select type</option>
                                                    <option value="work">Work</option>
                                                    <option value="home">Home</option>
                                                    <option value="other">Other</option>
                                                </select>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                    <button type="button" class="btn btn-primary" id="submitAddress">Add Address</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                </div>

                


                <div id="orders" class="section hidden">
                    <h2>Orders</h2>
                    
                    <% if (orders.length > 0) { %>
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Order Date</th>
                                <th>Products</th>
                                <th>Total Amount</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% orders.forEach(order => { %>
                            <tr>
                                <td><%= new Date(order.orderDate).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }) %></td>

                                <td>
                                    <div class="product-list">
                                        <% order.items.forEach(item => { %>
                                        <div class="product-info">
                                            <img src="/<%= item.productID.images[0] %>" alt="<%= item.productID %>" class="product-image">
                                            <span> x <%= item.quantity %></span>
                                        </div>
                                        <% }) %>
                                    </div>
                                </td>
                                <td>₹<%= order.totalAmount %></td>
                                <td>
                                    <% if (order.paymentStatus != 'Failed') { %>
                                    
                                        <%= order.orderStatus %>
                                        <% }%>
                                    <br>
                                    <% if (order.paymentStatus === 'Failed') { %>
                                        <span class="text-danger">Payment Failed</span>
                                    <% } else if (order.paymentStatus === 'Success') { %>
                                        <span class="text-success">Payment Successful</span>
                                    <% } else if (order.paymentStatus === 'Refund') { %>
                                        <span class="text-primary">Refunded Successful</span>
                                    <% } %>
                            </td>
                                <td>
                                    <button class="btn btn-info btn-sm viewOrder" data-id="<%= order._id %>">
                                      View
                                    </button>
                          
                                    <% if (order.paymentStatus === 'Failed') { %>
                                    <button class="btn btn-warning btn-sm retryPayment" data-id="<%= order._id %>">
                                      Retry Payment
                                    </button>
                                    <% } else if (order.orderStatus !== 'Delivered' && order.orderStatus !== 'Cancelled') { %>
                                    <button class="btn btn-danger btn-sm cancelOrder" data-id="<%= order._id %>">
                                      Cancel Order
                                    </button>
                                    <% } else if (order.orderStatus === 'Delivered') { %>
                                        <% if (order.cancellationRequested) { %> 
                                            <button class="btn btn-danger btn-sm returnOrder" data-id="<%= order._id %>" disabled>
                                                Return Order
                                              </button>
                                        <%} else { %> 
                                            <button class="btn btn-danger btn-sm returnOrder" data-id="<%= order._id %>">
                                                Return Order
                                              </button>        
                                        <% } %>

                                    <% } %>
                                </td>
                            </tr>
                            <% }) %>
                        </tbody>
                    </table>
                    <% } else { %>
                    <div class="alert alert-info">No orders found.</div>
                    <% } %>



                    <!-- Pagination Controls -->
                    <nav>
                        <ul class="pagination justify-content-center">
                            <% if (currentPage > 1) { %>
                                <li class="page-item">
                                    <a class="page-link" href="?page=<%= currentPage - 1 %>">Previous</a>
                                </li>
                            <% } %>

                            <% for (let i = 1; i <= totalPages; i++) { %>
                                <li class="page-item <%= currentPage === i ? 'active' : '' %>">
                                    <a class="page-link" href="?page=<%= i %>"><%= i %></a>
                                </li>
                            <% } %>

                            <% if (currentPage < totalPages) { %>
                                <li class="page-item">
                                    <a class="page-link" href="?page=<%= currentPage + 1 %>">Next</a>
                                </li>
                            <% } %>
                        </ul>
                    </nav>


                    <!-- Cancellation Reason Modal -->
                    <div class="modal fade" id="cancelOrderModal" tabindex="-1" aria-labelledby="cancelOrderModalLabel" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="cancelOrderModalLabel">Cancel Order</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <textarea id="cancellationReason" rows="4" class="form-control" placeholder="Enter reason for cancellation"></textarea>
                                    <div id="error-message" class="text-danger mt-2" style="display:none;"></div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                    <button type="button" class="btn btn-danger" id="confirmCancelBtn">Submit Cancellation</button>
                                </div>
                            </div>
                        </div>
                    </div>





                    <!-- Return Order Modal -->
                    <div id="returnOrderModal" class="modal" tabindex="-1" role="dialog">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title">Return Order</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <p>Select a reason for returning your order:</p>
                                    <select id="returnReasonSelect" class="form-control">
                                        <option value="">Select a reason</option>
                                        <option value="Damaged Item">Damaged Item</option>
                                        <option value="Wrong Item Sent">Wrong Item Sent</option>
                                        <option value="Not as Described">Not as Described</option>
                                        <option value="Changed My Mind">Changed My Mind</option>
                                        <option value="Others">Others</option>
                                    </select>
                                    <textarea id="customReason" class="form-control mt-2" placeholder="Please specify..." style="display: none;"></textarea>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" id="closeModal">Close</button>
                                    <button type="button" class="btn btn-primary" id="submitReturnRequest">Submit Return Request</button>
                                </div>
                            </div>
                        </div>
                    </div>




                    <!-- to show order details -->
                    <div class="modal fade" id="orderDetailModal" tabindex="-1" aria-labelledby="orderDetailModalLabel" aria-hidden="true">
                        <div class="modal-dialog modal-lg custom-modal">
                            <div class="modal-content">
                                <div class="modal-header border-0 custom-modal-header">
                                    <h5 class="modal-title" id="orderDetailModalLabel">Order Details</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body custom-modal-body">
                                    <h5 class="text-muted">Shipping Address:</h5>
                                    <p id="shippingAddress" class="border p-2 rounded custom-shipping-address"></p>
                                    
                                    <h5 class="text-muted">Order Information:</h5>
                                    <table class="table table-bordered custom-info-table">
                                        <tbody>
                                            <tr>
                                                <th>Ordered Date</th>
                                                <td id="orderedDate" class="fw-bold"></td>
                                            </tr>
                                            <tr>
                                                <th>Order Time</th>
                                                <td id="orderTime" class="fw-bold"></td>
                                            </tr>
                                            <tr>
                                                <th>Status</th>
                                                <td id="orderStatus" class="fw-bold"></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    
                                    <h5 class="text-muted">Ordered Products:</h5>
                                    <div id="orderedProducts" class="row custom-ordered-products"></div>
                                    
                                    <h5 class="text-muted">Total Amount: <span id="totalAmount" class="fw-bold"></span></h5>
                                </div>
                                <div class="modal-footer border-0">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                    <!-- Invoice Download Button -->
                                    <button id="downloadInvoice" class="btn btn-primary" style="display: none;">
                                        Download Invoice
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                

                <div id="wallet" class="section hidden">
                    <h2>Wallet</h2>
                    
                    <div class="wallet-balance mb-4">
                        <h4>Your Wallet Balance:</h4>
                        <h2 class="text-success">₹<%= wallet.balance.toFixed(2) %></h2>
                    </div>
                    <% if (wallet && wallet.transactions.length > 0) { %>
                        
                
                        <div class="transaction-history">
                            <h5>Transaction History</h5>
                            <div class="row">
                                <% wallet.transactions.forEach(transaction => { %>
                                    <div class="col-12 col-md-6 col-lg-4 mb-3">
                                        <div class="card h-100">
                                            <div class="card-body">
                                                <p class="card-text">
                                                    <strong>Date:</strong> <%= new Date(transaction.date).toLocaleDateString() %><br>
                                                    <strong>Description:</strong> <%= transaction.description %><br>
                                                    <strong>Amount:</strong>
                                                    <span class="<%= transaction.type === 'credit' ? 'text-success' : 'text-danger' %>">
                                                        <%= transaction.type === 'credit' ? '+' : '-' %> ₹<%= transaction.amount.toFixed(2) %>
                                                    </span>
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                <% }); %>
                            </div>
                        </div>
                    <% } else { %>
                        <p>No transactions available in your wallet.</p>
                    <% } %>
                
                    <div class="wallet-actions mt-4">
                        <button class="btn btn-primary" id="viewTransactionsButton">
                            View All Transactions
                        </button>
                    </div>
                </div>

                <!-- Add Funds Modal -->
                <div class="modal fade" id="addFundsModal" tabindex="-1" aria-labelledby="addFundsModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="addFundsModalLabel">Add Funds</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <form id="addFundsForm">
                                    <div class="mb-3">
                                        <label for="amount" class="form-label">Amount</label>
                                        <input type="number" class="form-control" id="amount" placeholder="Enter amount" required>
                                    </div>
                                    <button type="submit" class="btn btn-primary w-100">Add Funds</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>

            <!-- Transactions Modal -->
            <div class="modal fade" id="transactionsModal" tabindex="-1" aria-labelledby="transactionsModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="transactionsModalLabel">Your Transactions</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body d-flex justify-content-center">
                            <div id="transactionsContainer" class="list-group" style="max-height: 400px; width: 500px;">
                                <!-- Transactions will be loaded here -->
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>
                            
                

            </div>
        </div>
    </div>


    <!-- footer -->

    <%- include('partials/_footer')%>

<!--===============================================================================================-->	
<script src="/vendor/jquery/jquery-3.2.1.min.js"></script>
<!--===============================================================================================-->
	<script src="/vendor/animsition/js/animsition.min.js"></script>
<!--===============================================================================================-->
	<script src="/vendor/bootstrap/js/popper.js"></script>
	<script src="/vendor/bootstrap/js/bootstrap.min.js"></script>
<!--===============================================================================================-->
	<script src="/vendor/select2/select2.min.js"></script>
	<script>
		$(".js-select2").each(function(){
			$(this).select2({
				minimumResultsForSearch: 20,
				dropdownParent: $(this).next('.dropDownSelect2')
			});
		})
	</script>
<!--===============================================================================================-->
	<script src="/vendor/daterangepicker/moment.min.js"></script>
	<script src="/vendor/daterangepicker/daterangepicker.js"></script>
<!--===============================================================================================-->
	<script src="/vendor/slick/slick.min.js"></script>
	<script src="/js/slick-custom.js"></script>
<!--===============================================================================================-->
	<script src="/vendor/parallax100/parallax100.js"></script>
	<script>
        $('.parallax100').parallax100();
	</script>
<!--===============================================================================================-->
	<script src="/vendor/MagnificPopup/jquery.magnific-popup.min.js"></script>
	<script>
		$('.gallery-lb').each(function() { // the containers for all your galleries
			$(this).magnificPopup({
		        delegate: 'a', // the selector for gallery item
		        type: 'image',
		        gallery: {
		        	enabled:true
		        },
		        mainClass: 'mfp-fade'
		    });
		});
	</script>
<!--===============================================================================================-->
	<script src="/vendor/isotope/isotope.pkgd.min.js"></script>
<!--===============================================================================================-->
	<script src="/vendor/sweetalert/sweetalert.min.js"></script>
	<script>
		$('.js-addwish-b2').on('click', function(e){
			e.preventDefault();
		});

		$('.js-addwish-b2').each(function(){
			var nameProduct = $(this).parent().parent().find('.js-name-b2').html();
			$(this).on('click', function(){
				swal(nameProduct, "is added to wishlist !", "success");

				$(this).addClass('js-addedwish-b2');
				$(this).off('click');
			});
		});

		$('.js-addwish-detail').each(function(){
			var nameProduct = $(this).parent().parent().parent().find('.js-name-detail').html();

			$(this).on('click', function(){
				swal(nameProduct, "is added to wishlist !", "success");

				$(this).addClass('js-addedwish-detail');
				$(this).off('click');
			});
		});

		/*---------------------------------------------*/

		$('.js-addcart-detail').each(function(){
			var nameProduct = $(this).parent().parent().parent().parent().find('.js-name-detail').html();
			$(this).on('click', function(){
				swal(nameProduct, "is added to cart !", "success");
			});
		});
	
	</script>
<!--===============================================================================================-->
	<script src="/vendor/perfect-scrollbar/perfect-scrollbar.min.js"></script>
	<script>
		$('.js-pscroll').each(function(){
			$(this).css('position','relative');
			$(this).css('overflow','hidden');
			var ps = new PerfectScrollbar(this, {
				wheelSpeed: 1,
				scrollingThreshold: 1000,
				wheelPropagation: false,
			});

			$(window).on('resize', function(){
				ps.update();
			})
		});
	</script>


<script src="/js/main.js"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<script>

$(document).ready(function() {
    // Check if there's a last section saved in local storage and load it
    let lastSection = localStorage.getItem('lastSection') || '#details';
    showSection(lastSection);

    // Event listener for section clicks
    $('.section-toggle').on('click', function(e) {
        e.preventDefault();
        
        let targetSection = $(this).data('target');
        
        // Show the clicked section and save it to local storage
        showSection(targetSection);
        localStorage.setItem('lastSection', targetSection);
    });

    // Function to show the appropriate section and populate fields dynamically
    function showSection(sectionId) {
        $('.section').addClass('hidden'); // Hide all sections
        $(sectionId).removeClass('hidden'); // Show the target section
        
        // Dynamically populate fields based on the section ID
        if (sectionId === '#details') {
            populateDetails();
        } else if (sectionId === '#addresses') {
            populateAddresses();
        } else if (sectionId === '#orders') {
            populateOrders();
        } else if (sectionId === '#wishlist') {
            populateWishlist();
        }
    }

    // Example: Function to populate "My Details" section
    function populateDetails() {
        $('#username').val('<%=user.username%>');
        $('#email').val('<%=user.email%>');
    }

    // Example: Function to populate "Addresses" section
    function populateAddresses() {
        // Logic to dynamically load and display addresses if not already displayed
        // Assuming you have the address data rendered using EJS
        // You can load the addresses when this section is clicked.
    }

    // Example: Function to populate "Orders" section
    function populateOrders() {
        // Logic to dynamically load and display orders if not already displayed
    }

    // Example: Function to populate "Wishlist" section
    function populateWishlist() {
        // Logic to dynamically load and display wishlist items if not already displayed
    }
}); 
        
</script>


<!-- oder -->

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script src="/js/profile.js"> </script>
</body>
</html>
<script>
  window.userId = '<%= user._id %>';

</script>

<!-- razorpay -->

<script>
document.addEventListener('DOMContentLoaded', function() {
    const retryButtons = document.querySelectorAll('.retryPayment');

    retryButtons.forEach(button => {
        button.addEventListener('click', function() {
            const orderId = this.getAttribute('data-id');
            
            // Fetch Razorpay Order ID and retry payment
            axios.post(`/retryPayment/${orderId}`)
                .then(response => {
                    
                    const { razorpayOrderId, totalAmount, orderId } = response.data;

                    // Proceed to Razorpay payment
                    const options = {
                        key: 'rzp_test_gFsEtsAPkYQ4Fd', 
                        amount: totalAmount * 100,
                        currency: 'INR',
                        name: 'SmartSphere',
                        description: 'Retry Payment',
                        order_id: razorpayOrderId,
                        handler: function (paymentResponse) {
                            // Payment success, update backend
                            axios.post(`/payment/success/${orderId}`, {
                                paymentId: paymentResponse.razorpay_payment_id
                            }).then(() => {
                                Swal.fire({
                                    icon: 'success',
                                    title: 'Payment Successful',
                                    text: 'Payment ID: ' + paymentResponse.razorpay_payment_id
                                }).then(() => {
                                    window.location.href = `/order/confirmation/${orderId}`;
                                });
                            }).catch(err => {
                                Swal.fire({
                                    icon: 'error',
                                    title: 'Error',
                                    text: 'Unable to update payment status.'
                                });
                            });
                        },
                        prefill: {
                            name: 'User Name',  
                            email: 'email@example.com',
                            contact: '1234567890'
                        },
                        theme: {
                            color: '#F37254'
                        }
                    };

                    const rzp1 = new Razorpay(options);

                    // Handle Razorpay payment failed event
                    rzp1.on('payment.failed', function (response) {
                        Swal.fire({
                            icon: 'error',
                            title: 'Payment Failed',
                            text: 'Your payment failed. Please try again.'
                        });

                        // Update backend on payment failure
                        axios.post(`/payment/failure/${orderId}`, {
                            paymentId: response.error.metadata.payment_id
                        }).then(() => {
                            window.location.href = '/profile';
                        }).catch(err => {
                        });
                    });

                    // Open Razorpay modal for payment retry
                    rzp1.open();
                })
                .catch(err => {
                    Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: 'Unable to retry payment at this time.'
                    });
                });
        });
    });
});

  
</script>


<script>

const addFundsBtn = document.querySelector('.add-funds-btn');
const addFundsModal = new bootstrap.Modal(document.getElementById('addFundsModal'));

addFundsBtn.addEventListener('click', () => {
    addFundsModal.show();
});


const addFundsForm = document.getElementById('addFundsForm');
const walletBalanceElement = document.querySelector('.wallet-balance h2');

addFundsForm.addEventListener('submit', async (e) => {
    e.preventDefault(); // Prevent form from refreshing the page

    const amount = parseFloat(document.getElementById('amount').value);

    try {
        // Make an Axios POST request to add funds
        const response = await axios.post('/wallet/add-funds', { amount });

        if (response.data.success) {
            // Update the wallet balance in the UI
            walletBalanceElement.textContent = `₹${response.data.newBalance.toFixed(2)}`;

            // Close the modal
            const addFundsModal = bootstrap.Modal.getInstance(document.getElementById('addFundsModal'));
            addFundsModal.hide();

            // Optionally, show a success alert
            alert('Funds added successfully!');
        } else {
            alert('Failed to add funds. Please try again.');
        }
    } catch (error) {
        alert('An error occurred. Please try again.');
    }
});

</script>


<!-- return order -->
<script>
document.addEventListener('DOMContentLoaded', () => {
    const returnModal = document.getElementById('returnOrderModal');
    const returnReasonSelect = document.getElementById('returnReasonSelect');
    const customReason = document.getElementById('customReason');
    const submitReturnRequest = document.getElementById('submitReturnRequest');
    const closeModal = document.getElementById('closeModal');

    document.querySelectorAll('.returnOrder').forEach(button => {
        button.addEventListener('click', function() {
            const orderId = this.dataset.id;
            returnModal.dataset.orderId = orderId;
            returnModal.style.display = 'block'; 
        });
    });

    returnReasonSelect.addEventListener('change', function() {
        customReason.style.display = this.value === 'Others' ? 'block' : 'none';
    });

    submitReturnRequest.addEventListener('click', async () => {
        const orderId = returnModal.dataset.orderId;
        const selectedReason = returnReasonSelect.value;
        const reasonToSubmit = selectedReason === 'Others' ? customReason.value : selectedReason;

        if (!reasonToSubmit) {
            Swal.fire({
                icon: 'warning',
                title: 'Oops...',
                text: 'Please select a reason for the return.'
            });
            return;
        }

        try {
            
            const response = await axios.post(`/return-order/${orderId}`, {
                reason: reasonToSubmit
            });

            if (response.data.success) {
                Swal.fire({
                    icon: 'success',
                    title: 'Success!',
                    text: 'Your return request has been submitted.'
                }).then(() => {
                    returnModal.style.display = 'none'; 
                    location.reload();
                });
            } else {
                Swal.fire({
                    icon: 'error',
                    title: 'Error!',
                    text: 'There was an issue submitting your return request.'
                });
            }
        } catch (error) {
            Swal.fire({
                icon: 'error',
                title: 'Error!',
                text: 'There was an error processing your request.'
            });
        }
    });

    // Close the modal
    closeModal.addEventListener('click', () => {
        returnModal.style.display = 'none';
    });
});

</script>

<!-- refferal offer -->

<script>
    document.getElementById('shareBtn').addEventListener('click', async () => {
        const referralLink = `${window.location.origin}/register?referralCode=<%= user._id %>`;

        if (navigator.share) {
            try {
                await navigator.share({
                    title: 'Join me on this app!',
                    text: 'Sign up using my referral link!',
                    url: referralLink,
                });
            } catch (error) {
            }
        } else {
            navigator.clipboard.writeText(referralLink).then(() => {
                alert('Referral link copied to clipboard!');
            }).catch(err => {
            });
        }
    });
</script>